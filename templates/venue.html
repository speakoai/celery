{% extends "base.html" %}

{% block content %}
  <h2>Venue/Table Generator</h2>

  {% if step == 1 %}
    <h3>Step 1: Select Location</h3>
    <form method="POST" id="location-form">
      <input type="hidden" name="step" value="2">
      <input type="hidden" name="tenant_id" id="tenant_id">

      <div style="margin-bottom: 15px;">
        <label for="location_select">Choose a location:</label><br>
        <select id="location_select" name="location_id" required>
          <option value="">-- Select a location --</option>
          {% for loc in locations %}
            <option value="{{ loc.location_id }}" data-tenant-id="{{ loc.tenant_id }}">
              {{ loc.name }} (Tenant {{ loc.tenant_id }})
            </option>
          {% endfor %}
        </select>
      </div>

      <button type="submit">Next</button>
    </form>

    <script>
      const locationSelect = document.getElementById('location_select');
      const tenantIdInput = document.getElementById('tenant_id');

      locationSelect.addEventListener('change', () => {
        const selectedOption = locationSelect.options[locationSelect.selectedIndex];
        const tenantId = selectedOption.getAttribute('data-tenant-id');
        tenantIdInput.value = tenantId;
      });
    </script>
  {% endif %}

  {% if step == 2 %}
    <h3>Step 2: Confirm Availability for Selected Location</h3>
    <p><strong>Tenant ID:</strong> {{ selected_location.tenant_id }}</p>
    <p><strong>Location ID:</strong> {{ selected_location.location_id }}</p>

    {% if availabilities %}
      <table border="1" cellpadding="6" cellspacing="0">
        <tr>
          <th>Day of Week</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Is Closed?</th>
        </tr>
        {% for row in availabilities %}
          <tr>
            <td>{{ row.day_of_week }}</td>
            <td>{{ row.start_time }}</td>
            <td>{{ row.end_time }}</td>
            <td>{{ 'Yes' if row.is_closed else 'No' }}</td>
          </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>No availability found for this location.</p>
    {% endif %}

    <form method="POST" style="margin-top: 20px;">
      <input type="hidden" name="step" value="3">
      <input type="hidden" name="tenant_id" value="{{ selected_location.tenant_id }}">
      <input type="hidden" name="location_id" value="{{ selected_location.location_id }}">
      <button type="submit">Proceed to Upload CSV</button>
    </form>
  {% endif %}
{% endblock %}
